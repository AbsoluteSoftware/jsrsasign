function X509(){var p=ASN1HEX,n=p.getChildIdx,l=p.getV,b=p.getTLV,i=p.getVbyList,o=p.getVbyListEx,c=p.getTLVbyList,e=p.getTLVbyListEx,j=p.getIdxbyList,h=p.getIdxbyListEx,d=p.getVidx,m=p.oidname,a=X509,g=pemtohex,f;try{f=KJUR.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV}catch(k){}this.HEX2STAG={"0c":"utf8","13":"prn","16":"ia5","1a":"vis","1e":"bmp"};this.hex=null;this.version=0;this.foffset=0;this.aExtInfo=null;this.getVersion=function(){if(this.hex===null||this.version!==0){return this.version}if(c(this.hex,0,[0,0])!=="a003020102"){this.version=1;this.foffset=-1;return 1}this.version=3;return 3};this.getSerialNumberHex=function(){return o(this.hex,0,[0,0],"02")};this.getSignatureAlgorithmField=function(){var q=e(this.hex,0,[0,1]);return this.getAlgorithmIdentifierName(q)};this.getAlgorithmIdentifierName=function(q){for(var r in f){if(q===f[r]){return r}}return m(o(q,0,[0],"06"))};this.getIssuer=function(){var q={};q.array=this.getX500Name(this.getIssuerHex());q.str=this.getIssuerString();return q};this.getIssuerHex=function(){return c(this.hex,0,[0,3+this.foffset],"30")};this.getIssuerString=function(){return a.hex2dn(this.getIssuerHex())};this.getSubject=function(){var q={};q.array=this.getX500Name(this.getSubjectHex());q.str=this.getSubjectString();return q};this.getSubjectHex=function(){return c(this.hex,0,[0,5+this.foffset],"30")};this.getSubjectString=function(){return a.hex2dn(this.getSubjectHex())};this.getNotBefore=function(){var q=i(this.hex,0,[0,4+this.foffset,0]);q=q.replace(/(..)/g,"%$1");q=decodeURIComponent(q);return q};this.getNotAfter=function(){var q=i(this.hex,0,[0,4+this.foffset,1]);q=q.replace(/(..)/g,"%$1");q=decodeURIComponent(q);return q};this.getPublicKeyHex=function(){return p.getTLVbyList(this.hex,0,[0,6+this.foffset],"30")};this.getPublicKeyIdx=function(){return j(this.hex,0,[0,6+this.foffset],"30")};this.getPublicKeyContentIdx=function(){var q=this.getPublicKeyIdx();return j(this.hex,q,[1,0],"30")};this.getPublicKey=function(){return KEYUTIL.getKey(this.getPublicKeyHex(),null,"pkcs8pub")};this.getSignatureAlgorithmName=function(){var q=c(this.hex,0,[1],"30");return this.getAlgorithmIdentifierName(q)};this.getSignatureValueHex=function(){return i(this.hex,0,[2],"03",true)};this.verifySignature=function(s){var t=this.getSignatureAlgorithmField();var q=this.getSignatureValueHex();var r=c(this.hex,0,[0],"30");var u=new KJUR.crypto.Signature({alg:t});u.init(s);u.updateHex(r);return u.verify(q)};this.parseExt=function(z){var s,q,u;if(z===undefined){u=this.hex;if(this.version!==3){return -1}s=j(u,0,[0,7,0],"30");q=n(u,s)}else{u=pemtohex(z);var v=j(u,0,[0,3,0,0],"06");if(l(u,v)!="2a864886f70d01090e"){this.aExtInfo=new Array();return}s=j(u,0,[0,3,0,1,0],"30");q=n(u,s);this.hex=u}this.aExtInfo=new Array();for(var t=0;t<q.length;t++){var x={};x.critical=false;var w=n(u,q[t]);var r=0;if(w.length===3){x.critical=true;r=1}x.oid=p.hextooidstr(i(u,q[t],[0],"06"));var y=j(u,q[t],[1+r]);x.vidx=d(u,y);this.aExtInfo.push(x)}};this.getExtInfo=function(s){var q=this.aExtInfo;var t=s;if(!s.match(/^[0-9.]+$/)){t=KJUR.asn1.x509.OID.name2oid(s)}if(t===""){return undefined}for(var r=0;r<q.length;r++){if(q[r].oid===t){return q[r]}}return undefined};this.getExtBasicConstraints=function(r,v){if(r===undefined&&v===undefined){var t=this.getExtInfo("basicConstraints");if(t===undefined){return undefined}r=b(this.hex,t.vidx);v=t.critical}var q={extname:"basicConstraints"};if(v){q.critical=true}if(r==="3000"){return q}if(r==="30030101ff"){q.cA=true;return q}if(r.substr(0,12)==="30060101ff02"){var u=l(r,10);var s=parseInt(u,16);q.cA=true;q.pathLen=s;return q}throw new Error("basicConstraints parse error: "+r)};this.getExtKeyUsage=function(r,t){if(r===undefined&&t===undefined){var s=this.getExtInfo("keyUsage");if(s===undefined){return undefined}r=b(this.hex,s.vidx);t=s.critical}var q={extname:"keyUsage"};if(t){q.critical=true}q.names=this.getExtKeyUsageString(r).split(",");return q};this.getExtKeyUsageBin=function(r){if(r===undefined){var t=this.getExtInfo("keyUsage");if(t===undefined){return""}r=b(this.hex,t.vidx)}if(r.length!=8&&r.length!=10){throw new Error("malformed key usage value: "+r)}var q="000000000000000"+parseInt(r.substr(6),16).toString(2);if(r.length==8){q=q.slice(-8)}if(r.length==10){q=q.slice(-16)}q=q.replace(/0+$/,"");if(q==""){q="0"}return q};this.getExtKeyUsageString=function(s){var t=this.getExtKeyUsageBin(s);var q=new Array();for(var r=0;r<t.length;r++){if(t.substr(r,1)=="1"){q.push(X509.KEYUSAGE_NAME[r])}}return q.join(",")};this.getExtSubjectKeyIdentifier=function(s,u){if(s===undefined&&u===undefined){var t=this.getExtInfo("subjectKeyIdentifier");if(t===undefined){return undefined}s=b(this.hex,t.vidx);u=t.critical}var q={extname:"subjectKeyIdentifier"};if(u){q.critical=true}var r=l(s,0);q.kid={hex:r};return q};this.getExtAuthorityKeyIdentifier=function(w,u){if(w===undefined&&u===undefined){var q=this.getExtInfo("authorityKeyIdentifier");if(q===undefined){return undefined}w=b(this.hex,q.vidx);u=q.critical}var x={extname:"authorityKeyIdentifier"};if(u){x.critical=true}var v=n(w,0);for(var r=0;r<v.length;r++){var y=w.substr(v[r],2);if(y==="80"){x.kid={hex:l(w,v[r])}}if(y==="a1"){var t=b(w,v[r]);var s=this.getGeneralNames(t);x.issuer=s[0]["dn"]}if(y==="82"){x.sn={hex:l(w,v[r])}}}return x};this.getExtExtKeyUsage=function(t,v){if(t===undefined&&v===undefined){var u=this.getExtInfo("extKeyUsage");if(u===undefined){return undefined}t=b(this.hex,u.vidx);v=u.critical}var q={extname:"extKeyUsage",array:[]};if(v){q.critical=true}var r=n(t,0);for(var s=0;s<r.length;s++){q.array.push(m(l(t,r[s])))}return q};this.getExtExtKeyUsageName=function(){var u=this.getExtInfo("extKeyUsage");if(u===undefined){return u}var q=new Array();var t=b(this.hex,u.vidx);if(t===""){return q}var r=n(t,0);for(var s=0;s<r.length;s++){q.push(m(l(t,r[s])))}return q};this.getExtSubjectAltName=function(r,t){if(r===undefined&&t===undefined){var s=this.getExtInfo("subjectAltName");if(s===undefined){return undefined}r=b(this.hex,s.vidx);t=s.critical}var q={extname:"subjectAltName",array:[]};if(t){q.critical=true}q.array=this.getGeneralNames(r);return q};this.getExtIssuerAltName=function(r,t){if(r===undefined&&t===undefined){var s=this.getExtInfo("issuerAltName");if(s===undefined){return undefined}r=b(this.hex,s.vidx);t=s.critical}var q={extname:"issuerAltName",array:[]};if(t){q.critical=true}q.array=this.getGeneralNames(r);return q};this.getGeneralNames=function(u){var s=n(u,0);var q=[];for(var t=0;t<s.length;t++){var r=this.getGeneralName(b(u,s[t]));if(r!==undefined){q.push(r)}}return q};this.getGeneralName=function(r){var q=r.substr(0,2);var t=l(r,0);var s=hextorstr(t);if(q=="81"){return{rfc822:s}}if(q=="82"){return{dns:s}}if(q=="a4"){return{dn:{hex:t}}}if(q=="86"){return{uri:s}}if(q=="87"){return{ip:hextoip(t)}}return undefined};this.getExtSubjectAltName2=function(){var u,x,w;var v=this.getExtInfo("subjectAltName");if(v===undefined){return v}var q=new Array();var t=b(this.hex,v.vidx);var r=n(t,0);for(var s=0;s<r.length;s++){w=t.substr(r[s],2);u=l(t,r[s]);if(w==="81"){x=hextoutf8(u);q.push(["MAIL",x])}if(w==="82"){x=hextoutf8(u);q.push(["DNS",x])}if(w==="84"){x=X509.hex2dn(u,0);q.push(["DN",x])}if(w==="86"){x=hextoutf8(u);q.push(["URI",x])}if(w==="87"){x=hextoip(u);q.push(["IP",x])}}return q};this.getExtCRLDistributionPoints=function(u,w){if(u===undefined&&w===undefined){var v=this.getExtInfo("cRLDistributionPoints");if(v===undefined){return undefined}u=b(this.hex,v.vidx);w=v.critical}var r={extname:"cRLDistributionPoints",array:[]};if(w){r.critical=true}var s=n(u,0);for(var t=0;t<s.length;t++){var q=b(u,s[t]);r.array.push(this.getDistributionPoint(q))}return r};this.getDistributionPoint=function(v){var s={};var t=n(v,0);for(var u=0;u<t.length;u++){var r=v.substr(t[u],2);var q=b(v,t[u]);if(r=="a0"){s.dpname=this.getDistributionPointName(q)}}return s};this.getDistributionPointName=function(v){var s={};var t=n(v,0);for(var u=0;u<t.length;u++){var r=v.substr(t[u],2);var q=b(v,t[u]);if(r=="a0"){s.full=this.getGeneralNames(q)}}return s};this.getExtCRLDistributionPointsURI=function(){var v=this.getExtInfo("cRLDistributionPoints");if(v===undefined){return v}var q=new Array();var r=n(this.hex,v.vidx);for(var t=0;t<r.length;t++){try{var w=i(this.hex,r[t],[0,0,0],"86");var u=hextoutf8(w);q.push(u)}catch(s){}}return q};this.getExtAIAInfo=function(){var u=this.getExtInfo("authorityInfoAccess");if(u===undefined){return u}var q={ocsp:[],caissuer:[]};var r=n(this.hex,u.vidx);for(var s=0;s<r.length;s++){var v=i(this.hex,r[s],[0],"06");var t=i(this.hex,r[s],[1],"86");if(v==="2b06010505073001"){q.ocsp.push(hextoutf8(t))}if(v==="2b06010505073002"){q.caissuer.push(hextoutf8(t))}}return q};this.getExtAuthorityInfoAccess=function(x,v){if(x===undefined&&v===undefined){var q=this.getExtInfo("authorityInfoAccess");if(q===undefined){return undefined}x=b(this.hex,q.vidx);v=q.critical}var y={extname:"authorityInfoAccess",array:[]};if(v){y.critical=true}var w=n(x,0);for(var r=0;r<w.length;r++){var u=o(x,w[r],[0],"06");var s=i(x,w[r],[1],"86");var t=hextoutf8(s);if(u=="2b06010505073001"){y.array.push({ocsp:t})}else{if(u=="2b06010505073002"){y.array.push({caissuer:t})}else{throw new Error("unknown method: "+u)}}}return y};this.getExtCertificatePolicies=function(u,x){if(u===undefined&&x===undefined){var w=this.getExtInfo("certificatePolicies");if(w===undefined){return undefined}u=b(this.hex,w.vidx);x=w.critical}var q={extname:"certificatePolicies",array:[]};if(x){q.critical=true}var r=n(u,0);for(var s=0;s<r.length;s++){var v=b(u,r[s]);var t=this.getPolicyInformation(v);q.array.push(t)}return q};this.getPolicyInformation=function(u){var q={};var w=i(u,0,[0],"06");q.policyoid=m(w);var x=h(u,0,[1],"30");if(x!=-1){q.array=[];var r=n(u,x);for(var s=0;s<r.length;s++){var v=b(u,r[s]);var t=this.getPolicyQualifierInfo(v);q.array.push(t)}}return q};this.getPolicyQualifierInfo=function(r){var q={};var s=i(r,0,[0],"06");if(s==="2b06010505070201"){var u=o(r,0,[1],"16");q.cps=hextorstr(u)}else{if(s==="2b06010505070202"){var t=c(r,0,[1],"30");q.unotice=this.getUserNotice(t)}}return q};this.getUserNotice=function(u){var r={};var s=n(u,0);for(var t=0;t<s.length;t++){var q=b(u,s[t]);if(q.substr(0,2)!="30"){r.exptext=this.getDisplayText(q)}}return r};this.getDisplayText=function(r){var s={"0c":"utf8","16":"ia5","1a":"vis","1e":"bmp"};var q={};q.type=s[r.substr(0,2)];q.str=hextorstr(l(r,0));return q};this.getX500NameRule=function(q){var x=true;var B=true;var A=false;var r="";var u="";var D=null;var y=[];for(var t=0;t<q.length;t++){var v=q[t];for(var s=0;s<v.length;s++){y.push(v[s])}}for(var t=0;t<y.length;t++){var C=y[t];var E=C.ds;var z=C.value;var w=C.type;r+=":"+E;if(E!="prn"&&E!="utf8"&&E!="ia5"){return"mixed"}if(E=="ia5"){if(w!="CN"){return"mixed"}else{if(!KJUR.lang.String.isMail(z)){return"mixed"}else{continue}}}if(w=="C"){if(E=="prn"){continue}else{return"mixed"}}u+=":"+E;if(D==null){D=E}else{if(D!==E){return"mixed"}}}if(D==null){return"prn"}else{return D}};this.getX500Name=function(t){var q=[];var r=n(t,0);for(var s=0;s<r.length;s++){q.push(this.getRDN(b(t,r[s])))}return q};this.getRDN=function(t){var q=[];var r=n(t,0);for(var s=0;s<r.length;s++){q.push(this.getAttrTypeAndValue(b(t,r[s])))}return q};this.getAttrTypeAndValue=function(s){var q={type:null,value:null,ds:null};var r=n(s,0);var v=i(s,r[0],[],"06");var u=i(s,r[1],[]);var t=KJUR.asn1.ASN1Util.oidHexToInt(v);q.type=KJUR.asn1.x509.OID.oid2atype(t);q.value=hextorstr(u);q.ds=this.HEX2STAG[s.substr(r[1],2)];return q};this.readCertPEM=function(q){this.readCertHex(g(q))};this.readCertHex=function(q){this.hex=q;this.getVersion();try{j(this.hex,0,[0,7],"a3");this.parseExt()}catch(r){}};this.getParam=function(){var q={};q.version=this.getVersion();q.serial={hex:this.getSerialNumberHex()};q.sigalg=this.getSignatureAlgorithmField();q.issuer=this.getIssuer();q.notbefore=this.getNotBefore();q.notafter=this.getNotAfter();q.subject=this.getSubject();q.sbjpubkey=hextopem(this.getPublicKeyHex(),"PUBLIC KEY");if(this.aExtInfo.length>0){q.ext=this.getExtParamArray()}q.sighex=this.getSignatureValueHex();return q};this.getExtParamArray=function(){var q=[];var r=this.aExtInfo;for(var s=0;s<r.length;s++){var v=r[s];var u=v.oid;var t=undefined;if(u=="2.5.29.14"){t=this.getExtSubjectKeyIdentifier()}else{if(u=="2.5.29.15"){t=this.getExtKeyUsage()}else{if(u=="2.5.29.17"){t=this.getExtSubjectAltName()}else{if(u=="2.5.29.18"){t=this.getExtIssuerAltName()}else{if(u=="2.5.29.19"){t=this.getExtBasicConstraints()}else{if(u=="2.5.29.31"){t=this.getExtCRLDistributionPoints()}else{if(u=="2.5.29.32"){t=this.getExtCertificatePolicies()}else{if(u=="2.5.29.35"){t=this.getExtAuthorityKeyIdentifier()}else{if(u=="2.5.29.37"){t=this.getExtExtKeyUsage()}else{if(u=="1.3.6.1.5.5.7.1.1"){t=this.getExtAuthorityInfoAccess()}}}}}}}}}}if(t!=undefined){q.push(t)}}return q};this.getInfo=function(){var r=function(K){var J=JSON.stringify(K.array).replace(/[\[\]\{\}\"]/g,"");return J};var y=function(P){var N="";var J=P.array;for(var M=0;M<J.length;M++){var O=J[M];N+="    policy oid: "+O.policyoid+"\n";if(O.array===undefined){continue}for(var L=0;L<O.array.length;L++){var K=O.array[L];if(K.cps!==undefined){N+="    cps: "+K.cps+"\n"}}}return N};var B=function(N){var M="";var J=N.array;for(var L=0;L<J.length;L++){var O=J[L];try{if(O.dpname.full[0].uri!==undefined){M+="    "+O.dpname.full[0].uri+"\n"}}catch(K){}try{if(O.dname.full[0].dn.hex!==undefined){M+="    "+X509.hex2dn(O.dpname.full[0].dn.hex)+"\n"}}catch(K){}}return M};var z=function(N){var M="";var J=N.array;for(var K=0;K<J.length;K++){var L=J[K];if(L.caissuer!==undefined){M+="    caissuer: "+L.caissuer+"\n"}if(L.ocsp!==undefined){M+="    ocsp: "+L.ocsp+"\n"}}return M};var t=X509;var D,C,I;D="Basic Fields\n";D+="  serial number: "+this.getSerialNumberHex()+"\n";D+="  signature algorithm: "+this.getSignatureAlgorithmField()+"\n";D+="  issuer: "+this.getIssuerString()+"\n";D+="  notBefore: "+this.getNotBefore()+"\n";D+="  notAfter: "+this.getNotAfter()+"\n";D+="  subject: "+this.getSubjectString()+"\n";D+="  subject public key info: \n";C=this.getPublicKey();D+="    key algorithm: "+C.type+"\n";if(C.type==="RSA"){D+="    n="+hextoposhex(C.n.toString(16)).substr(0,16)+"...\n";D+="    e="+hextoposhex(C.e.toString(16))+"\n"}I=this.aExtInfo;if(I!==undefined&&I!==null){D+="X509v3 Extensions:\n";for(var F=0;F<I.length;F++){var H=I[F];var q=KJUR.asn1.x509.OID.oid2name(H.oid);if(q===""){q=H.oid}var E="";if(H.critical===true){E="CRITICAL"}D+="  "+q+" "+E+":\n";if(q==="basicConstraints"){var u=this.getExtBasicConstraints();if(u.cA===undefined){D+="    {}\n"}else{D+="    cA=true";if(u.pathLen!==undefined){D+=", pathLen="+u.pathLen}D+="\n"}}else{if(q==="keyUsage"){D+="    "+this.getExtKeyUsageString()+"\n"}else{if(q==="subjectKeyIdentifier"){D+="    "+this.getExtSubjectKeyIdentifier().kid.hex+"\n"}else{if(q==="authorityKeyIdentifier"){var v=this.getExtAuthorityKeyIdentifier();if(v.kid!==undefined){D+="    kid="+v.kid.hex+"\n"}}else{if(q==="extKeyUsage"){var G=this.getExtExtKeyUsage().array;D+="    "+G.join(", ")+"\n"}else{if(q==="subjectAltName"){var w=r(this.getExtSubjectAltName());D+="    "+w+"\n"}else{if(q==="cRLDistributionPoints"){var A=this.getExtCRLDistributionPoints();D+=B(A)}else{if(q==="authorityInfoAccess"){var x=this.getExtAuthorityInfoAccess();D+=z(x)}else{if(q==="certificatePolicies"){D+=y(this.getExtCertificatePolicies())}}}}}}}}}}}D+="signature algorithm: "+this.getSignatureAlgorithmName()+"\n";D+="signature: "+this.getSignatureValueHex().substr(0,16)+"...\n";return D}}X509.hex2dn=function(f,b){if(b===undefined){b=0}if(f.substr(b,2)!=="30"){throw new Error("malformed DN")}var c=new Array();var d=ASN1HEX.getChildIdx(f,b);for(var e=0;e<d.length;e++){c.push(X509.hex2rdn(f,d[e]))}c=c.map(function(a){return a.replace("/","\\/")});return"/"+c.join("/")};X509.hex2rdn=function(f,b){if(b===undefined){b=0}if(f.substr(b,2)!=="31"){throw new Error("malformed RDN")}var c=new Array();var d=ASN1HEX.getChildIdx(f,b);for(var e=0;e<d.length;e++){c.push(X509.hex2attrTypeValue(f,d[e]))}c=c.map(function(a){return a.replace("+","\\+")});return c.join("+")};X509.hex2attrTypeValue=function(d,i){var j=ASN1HEX;var h=j.getV;if(i===undefined){i=0}if(d.substr(i,2)!=="30"){throw new Error("malformed attribute type and value")}var g=j.getChildIdx(d,i);if(g.length!==2||d.substr(g[0],2)!=="06"){"malformed attribute type and value"}var b=h(d,g[0]);var f=KJUR.asn1.ASN1Util.oidHexToInt(b);var e=KJUR.asn1.x509.OID.oid2atype(f);var a=h(d,g[1]);var c=hextorstr(a);return e+"="+c};X509.getPublicKeyFromCertHex=function(b){var a=new X509();a.readCertHex(b);return a.getPublicKey()};X509.getPublicKeyFromCertPEM=function(b){var a=new X509();a.readCertPEM(b);return a.getPublicKey()};X509.getPublicKeyInfoPropOfCertPEM=function(c){var e=ASN1HEX;var g=e.getVbyList;var b={};var a,f,d;b.algparam=null;a=new X509();a.readCertPEM(c);f=a.getPublicKeyHex();b.keyhex=g(f,0,[1],"03").substr(2);b.algoid=g(f,0,[0,0],"06");if(b.algoid==="2a8648ce3d0201"){b.algparam=g(f,0,[0,1],"06")}return b};X509.KEYUSAGE_NAME=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"];