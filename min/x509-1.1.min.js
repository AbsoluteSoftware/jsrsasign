function X509(){var n=ASN1HEX,l=n.getChildIdx,j=n.getV,b=n.getTLV,h=n.getVbyList,m=n.getVbyListEx,c=n.getTLVbyList,e=n.getTLVbyListEx,i=n.getIdxbyList,d=n.getVidx,k=n.oidname,a=X509,g=pemtohex,f=KJUR.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV;this.hex=null;this.version=0;this.foffset=0;this.aExtInfo=null;this.getVersion=function(){if(this.hex===null||this.version!==0){return this.version}if(c(this.hex,0,[0,0])!=="a003020102"){this.version=1;this.foffset=-1;return 1}this.version=3;return 3};this.getSerialNumberHex=function(){return h(this.hex,0,[0,1+this.foffset],"02")};this.getSignatureAlgorithmField=function(){var p=null;var o=e(this.hex,0,[0,1]);for(var q in f){if(o===f[q]){return q}}return k(m(this.hex,0,[0,1,0],"06"))};this.getIssuerHex=function(){return c(this.hex,0,[0,3+this.foffset],"30")};this.getIssuerString=function(){return a.hex2dn(this.getIssuerHex())};this.getSubjectHex=function(){return c(this.hex,0,[0,5+this.foffset],"30")};this.getSubjectString=function(){return a.hex2dn(this.getSubjectHex())};this.getNotBefore=function(){var o=h(this.hex,0,[0,4+this.foffset,0]);o=o.replace(/(..)/g,"%$1");o=decodeURIComponent(o);return o};this.getNotAfter=function(){var o=h(this.hex,0,[0,4+this.foffset,1]);o=o.replace(/(..)/g,"%$1");o=decodeURIComponent(o);return o};this.getPublicKeyHex=function(){return n.getTLVbyList(this.hex,0,[0,6+this.foffset],"30")};this.getPublicKeyIdx=function(){return i(this.hex,0,[0,6+this.foffset],"30")};this.getPublicKeyContentIdx=function(){var o=this.getPublicKeyIdx();return i(this.hex,o,[1,0],"30")};this.getPublicKey=function(){return KEYUTIL.getKey(this.getPublicKeyHex(),null,"pkcs8pub")};this.getSignatureAlgorithmName=function(){return k(h(this.hex,0,[1,0],"06"))};this.getSignatureValueHex=function(){return h(this.hex,0,[2],"03",true)};this.verifySignature=function(q){var r=this.getSignatureAlgorithmField();var o=this.getSignatureValueHex();var p=c(this.hex,0,[0],"30");var s=new KJUR.crypto.Signature({alg:r});s.init(q);s.updateHex(p);return s.verify(o)};this.parseExt=function(x){var q,o,s;if(x===undefined){s=this.hex;if(this.version!==3){return -1}q=i(s,0,[0,7,0],"30");o=l(s,q)}else{s=pemtohex(x);var t=i(s,0,[0,3,0,0],"06");if(j(s,t)!="2a864886f70d01090e"){this.aExtInfo=new Array();return}q=i(s,0,[0,3,0,1,0],"30");o=l(s,q);this.hex=s}this.aExtInfo=new Array();for(var r=0;r<o.length;r++){var v={};v.critical=false;var u=l(s,o[r]);var p=0;if(u.length===3){v.critical=true;p=1}v.oid=n.hextooidstr(h(s,o[r],[0],"06"));var w=i(s,o[r],[1+p]);v.vidx=d(s,w);this.aExtInfo.push(v)}};this.getExtInfo=function(q){var o=this.aExtInfo;var r=q;if(!q.match(/^[0-9.]+$/)){r=KJUR.asn1.x509.OID.name2oid(q)}if(r===""){return undefined}for(var p=0;p<o.length;p++){if(o[p].oid===r){return o[p]}}return undefined};this.getExtBasicConstraints=function(){var q=this.getExtInfo("basicConstraints");if(q===undefined){return q}var o=j(this.hex,q.vidx);if(o===""){return{}}if(o==="0101ff"){return{cA:true}}if(o.substr(0,8)==="0101ff02"){var r=j(o,6);var p=parseInt(r,16);return{cA:true,pathLen:p}}throw"basicConstraints parse error"};this.getExtKeyUsageBin=function(){var r=this.getExtInfo("keyUsage");if(r===undefined){return""}var p=j(this.hex,r.vidx);if(p.length%2!=0||p.length<=2){throw"malformed key usage value"}var o=parseInt(p.substr(0,2));var q=parseInt(p.substr(2),16).toString(2);return q.substr(0,q.length-o)};this.getExtKeyUsageString=function(){var q=this.getExtKeyUsageBin();var o=new Array();for(var p=0;p<q.length;p++){if(q.substr(p,1)=="1"){o.push(X509.KEYUSAGE_NAME[p])}}return o.join(",")};this.getExtSubjectKeyIdentifier=function(){var o=this.getExtInfo("subjectKeyIdentifier");if(o===undefined){return o}return j(this.hex,o.vidx)};this.getExtAuthorityKeyIdentifier=function(){var s=this.getExtInfo("authorityKeyIdentifier");if(s===undefined){return s}var o={};var r=b(this.hex,s.vidx);var p=l(r,0);for(var q=0;q<p.length;q++){if(r.substr(p[q],2)==="80"){o.kid=j(r,p[q])}}return o};this.getExtExtKeyUsageName=function(){var s=this.getExtInfo("extKeyUsage");if(s===undefined){return s}var o=new Array();var r=b(this.hex,s.vidx);if(r===""){return o}var p=l(r,0);for(var q=0;q<p.length;q++){o.push(k(j(r,p[q])))}return o};this.getExtSubjectAltName=function(){var p=this.getExtSubjectAltName2();var o=new Array();for(var q=0;q<p.length;q++){if(p[q][0]==="DNS"){o.push(p[q][1])}}return o};this.getExtSubjectAltName2=function(){var s,v,u;var t=this.getExtInfo("subjectAltName");if(t===undefined){return t}var o=new Array();var r=b(this.hex,t.vidx);var p=l(r,0);for(var q=0;q<p.length;q++){u=r.substr(p[q],2);s=j(r,p[q]);if(u==="81"){v=hextoutf8(s);o.push(["MAIL",v])}if(u==="82"){v=hextoutf8(s);o.push(["DNS",v])}if(u==="84"){v=X509.hex2dn(s,0);o.push(["DN",v])}if(u==="86"){v=hextoutf8(s);o.push(["URI",v])}if(u==="87"){v=hextoip(s);o.push(["IP",v])}}return o};this.getExtCRLDistributionPointsURI=function(){var t=this.getExtInfo("cRLDistributionPoints");if(t===undefined){return t}var o=new Array();var p=l(this.hex,t.vidx);for(var r=0;r<p.length;r++){try{var u=h(this.hex,p[r],[0,0,0],"86");var s=hextoutf8(u);o.push(s)}catch(q){}}return o};this.getExtAIAInfo=function(){var s=this.getExtInfo("authorityInfoAccess");if(s===undefined){return s}var o={ocsp:[],caissuer:[]};var p=l(this.hex,s.vidx);for(var q=0;q<p.length;q++){var t=h(this.hex,p[q],[0],"06");var r=h(this.hex,p[q],[1],"86");if(t==="2b06010505073001"){o.ocsp.push(hextoutf8(r))}if(t==="2b06010505073002"){o.caissuer.push(hextoutf8(r))}}return o};this.getExtCertificatePolicies=function(){var r=this.getExtInfo("certificatePolicies");if(r===undefined){return r}var o=b(this.hex,r.vidx);var x=[];var v=l(o,0);for(var u=0;u<v.length;u++){var w={};var q=l(o,v[u]);w.id=k(j(o,q[0]));if(q.length===2){var p=l(o,q[1]);for(var t=0;t<p.length;t++){var s=h(o,p[t],[0],"06");if(s==="2b06010505070201"){w.cps=hextoutf8(h(o,p[t],[1]))}else{if(s==="2b06010505070202"){w.unotice=hextoutf8(h(o,p[t],[1,0]))}}}}x.push(w)}return x};this.readCertPEM=function(o){this.readCertHex(g(o))};this.readCertHex=function(o){this.hex=o;this.getVersion();try{i(this.hex,0,[0,7],"a3");this.parseExt()}catch(p){}};this.getInfo=function(){var p=X509;var E,x,C;E="Basic Fields\n";E+="  serial number: "+this.getSerialNumberHex()+"\n";E+="  signature algorithm: "+this.getSignatureAlgorithmField()+"\n";E+="  issuer: "+this.getIssuerString()+"\n";E+="  notBefore: "+this.getNotBefore()+"\n";E+="  notAfter: "+this.getNotAfter()+"\n";E+="  subject: "+this.getSubjectString()+"\n";E+="  subject public key info: \n";x=this.getPublicKey();E+="    key algorithm: "+x.type+"\n";if(x.type==="RSA"){E+="    n="+hextoposhex(x.n.toString(16)).substr(0,16)+"...\n";E+="    e="+hextoposhex(x.e.toString(16))+"\n"}C=this.aExtInfo;if(C!==undefined&&C!==null){E+="X509v3 Extensions:\n";for(var v=0;v<C.length;v++){var q=C[v];var D=KJUR.asn1.x509.OID.oid2name(q.oid);if(D===""){D=q.oid}var A="";if(q.critical===true){A="CRITICAL"}E+="  "+D+" "+A+":\n";if(D==="basicConstraints"){var y=this.getExtBasicConstraints();if(y.cA===undefined){E+="    {}\n"}else{E+="    cA=true";if(y.pathLen!==undefined){E+=", pathLen="+y.pathLen}E+="\n"}}else{if(D==="keyUsage"){E+="    "+this.getExtKeyUsageString()+"\n"}else{if(D==="subjectKeyIdentifier"){E+="    "+this.getExtSubjectKeyIdentifier()+"\n"}else{if(D==="authorityKeyIdentifier"){var o=this.getExtAuthorityKeyIdentifier();if(o.kid!==undefined){E+="    kid="+o.kid+"\n"}}else{if(D==="extKeyUsage"){var z=this.getExtExtKeyUsageName();E+="    "+z.join(", ")+"\n"}else{if(D==="subjectAltName"){var w=this.getExtSubjectAltName2();E+="    "+w+"\n"}else{if(D==="cRLDistributionPoints"){var B=this.getExtCRLDistributionPointsURI();E+="    "+B+"\n"}else{if(D==="authorityInfoAccess"){var t=this.getExtAIAInfo();if(t.ocsp!==undefined){E+="    ocsp: "+t.ocsp.join(",")+"\n"}if(t.caissuer!==undefined){E+="    caissuer: "+t.caissuer.join(",")+"\n"}}else{if(D==="certificatePolicies"){var r=this.getExtCertificatePolicies();for(var u=0;u<r.length;u++){if(r[u].id!==undefined){E+="    policy oid: "+r[u].id+"\n"}if(r[u].cps!==undefined){E+="    cps: "+r[u].cps+"\n"}}}}}}}}}}}}}E+="signature algorithm: "+this.getSignatureAlgorithmName()+"\n";E+="signature: "+this.getSignatureValueHex().substr(0,16)+"...\n";return E}}X509.hex2dn=function(f,b){if(b===undefined){b=0}if(f.substr(b,2)!=="30"){throw"malformed DN"}var c=new Array();var d=ASN1HEX.getChildIdx(f,b);for(var e=0;e<d.length;e++){c.push(X509.hex2rdn(f,d[e]))}c=c.map(function(a){return a.replace("/","\\/")});return"/"+c.join("/")};X509.hex2rdn=function(f,b){if(b===undefined){b=0}if(f.substr(b,2)!=="31"){throw"malformed RDN"}var c=new Array();var d=ASN1HEX.getChildIdx(f,b);for(var e=0;e<d.length;e++){c.push(X509.hex2attrTypeValue(f,d[e]))}c=c.map(function(a){return a.replace("+","\\+")});return c.join("+")};X509.hex2attrTypeValue=function(d,i){var j=ASN1HEX;var h=j.getV;if(i===undefined){i=0}if(d.substr(i,2)!=="30"){throw"malformed attribute type and value"}var g=j.getChildIdx(d,i);if(g.length!==2||d.substr(g[0],2)!=="06"){"malformed attribute type and value"}var b=h(d,g[0]);var f=KJUR.asn1.ASN1Util.oidHexToInt(b);var e=KJUR.asn1.x509.OID.oid2atype(f);var a=h(d,g[1]);var c=hextorstr(a);return e+"="+c};X509.getPublicKeyFromCertHex=function(b){var a=new X509();a.readCertHex(b);return a.getPublicKey()};X509.getPublicKeyFromCertPEM=function(b){var a=new X509();a.readCertPEM(b);return a.getPublicKey()};X509.getPublicKeyInfoPropOfCertPEM=function(c){var e=ASN1HEX;var g=e.getVbyList;var b={};var a,f,d;b.algparam=null;a=new X509();a.readCertPEM(c);f=a.getPublicKeyHex();b.keyhex=g(f,0,[1],"03").substr(2);b.algoid=g(f,0,[0,0],"06");if(b.algoid==="2a8648ce3d0201"){b.algparam=g(f,0,[0,1],"06")}return b};X509.KEYUSAGE_NAME=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"];