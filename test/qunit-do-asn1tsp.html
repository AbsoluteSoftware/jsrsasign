<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" 
          "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta charset="utf-8">
<title>QUnit for ASN1 Encoder Class 'asn1tsp.js'</title>
<script type="text/javascript" src="jquery-1.4.2.min.js"></script>
<script type="text/javascript" src="qunit.js"></script>
<link rel="stylesheet" href="qunit.css" type="text/css" media="screen" />

<script src="../ext/cj/cryptojs-312-core-fix.js"></script>
<script src="../ext/cj/x64-core.js"></script>
<script src="../ext/cj/cipher-core_min.js"></script>
<script src="../ext/cj/aes_min.js"></script>
<script src="../ext/cj/tripledes_min.js"></script>
<script src="../ext/cj/enc-base64_min.js"></script>
<script src="../ext/cj/md5_min.js"></script>
<script src="../ext/cj/sha1_min.js"></script>
<script src="../ext/cj/sha256_min.js"></script>
<script src="../ext/cj/sha224_min.js"></script>
<script src="../ext/cj/sha512_min.js"></script>
<script src="../ext/cj/sha384_min.js"></script>
<script src="../ext/cj/ripemd160_min.js"></script>
<script src="../ext/cj/hmac_min.js"></script>
<script src="../ext/cj/pbkdf2_min.js"></script>

<script src="../ext/yahoo.js"></script>
<script src="../ext/jsbn.js"></script>
<script src="../ext/jsbn2.js"></script>
<script src="../ext/prng4.js"></script>
<script src="../ext/rng.js"></script>
<script src="../ext/rsa.js"></script>
<script src="../ext/rsa2.js"></script>
<script src="../ext/base64.js"></script>
<script src="../src/base64x-1.1.js"></script>
<script src="../src/asn1hex-1.1.js"></script>
<script src="../src/rsapem-1.1.js"></script>
<script src="../src/rsasign-1.2.js"></script>
<script src="../src/crypto-1.1.js"></script>
<script src="../src/keyutil-1.0.js"></script>
<script src="../src/asn1-1.0.js"></script>
<script src="../src/asn1x509-1.0.js"></script>
<script src="../src/asn1cms-1.0.js"></script>
<script src="../src/asn1tsp-1.0.js"></script>
<script src="../src/x509-1.1.js"></script>

<script type="text/javascript">
<!--
$(document).ready(function(){

// _test/z4.* RSA 2048bit
var sZ4_PRVP8PPEM = 
"-----BEGIN PRIVATE KEY-----\n" + 
"MIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQDfdOqotHd55SYO\n" + 
"0dLz2oXengw/tZ+q3ZmOPeVmMuOMIYO/Cv1wk2U0OK4pug4OBSJPhl09Zs6IwB8N\n" + 
"wPOU7EDTgMOcQUYB/6QNCI1J7Zm2oLtuchzz4pIb+o4ZAhVprLhRyvqi8OTKQ7kf\n" + 
"Gfs5Tuwmn1M/0fQkfzMxADpjOKNgf0uy6lN6utjdTrPKKFUQNdc6/Ty8EeTnQEwU\n" + 
"lsT2LAXCfEKxTn5RlRljDztS7Sfgs8VL0FPy1Qi8B+dFcgRYKFrcpsVaZ1lBmXKs\n" + 
"XDRu5QR/Rg3f9DRq4GR1sNH8RLY9uApMl2SNz+sR4zRPG85R/se5Q06Gu0BUQ3UP\n" + 
"m67ETVZLAgMBAAECggEADjU54mYvHpICXHjc5+JiFqiH8NkUgOG8LL4kwt3DeBp9\n" + 
"bP0+5hSJH8vmzwJkeGG9L79EWG4b/bfxgYdeNX7cFFagmWPRFrlxbd64VRYFawZH\n" + 
"RJt+2cbzMVI6DL8EK4bu5Ux5qTiV44Jw19hoD9nDzCTfPzSTSGrKD3iLPdnREYaI\n" + 
"GDVxcjBv3Tx6rrv3Z2lhHHKhEHb0RRjATcjAVKV9NZhMajJ4l9pqJ3A4IQrCBl95\n" + 
"ux6Xm1oXP0i6aR78cjchsCpcMXdP3WMsvHgTlsZT0RZLFHrvkiNHlPiil4G2/eHk\n" + 
"wvT//CrcbO6SmI/zCtMmypuHJqcr+Xb7GPJoa64WoQKBgQDwrfelf3Rdfo9kaK/b\n" + 
"rBmbu1++qWpYVPTedQy84DK2p3GE7YfKyI+fhbnw5ol3W1jjfvZCmK/p6eZR4jgy\n" + 
"J0KJ76z53T8HoDTF+FTkR55oM3TEM46XzI36RppWP1vgcNHdz3U4DAqkMlAh4lVm\n" + 
"3GiKPGX5JHHe7tWz/uZ55Kk58QKBgQDtrkqdSzWlOjvYD4mq4m8jPgS7v3hiHd+1\n" + 
"OT8S37zdoT8VVzo2T4SF+fBhI2lWYzpQp2sCjLmCwK9k/Gur55H2kTBTwzlQ6WSL\n" + 
"Te9Zj+eoMGklIirA+8YdQHXrO+CCw9BTJAF+c3c3xeUOLXafzyW29bASGfUtA7Ax\n" + 
"QAsR+Rr3+wKBgAwfZxrh6ZWP+17+WuVArOWIMZFj7SRX2yGdWa/lxwgmNPSSFkXj\n" + 
"hkBttujoY8IsSrTivzqpgCrTCjPTpir4iURzWw4W08bpjd7u3C/HX7Y16Uq8ohEJ\n" + 
"T5lslveDJ3iNljSK74eMK7kLg7fBM7YDogxccHJ1IHsvInp3e1pmZxOxAoGAO+bS\n" + 
"TUQ4N/UuQezgkF3TDrnBraO67leDGwRbfiE/U0ghQvqh5DA0QSPVzlWDZc9KUitv\n" + 
"j8vxsR9o1PW9GS0an17GJEYuetLnkShKK3NWOhBBX6d1yP9rVdH6JhgIJEy/g0Su\n" + 
"z7TAFiFc8i7JF8u4QJ05C8bZAMhOLotqftQeVOMCgYAid8aaRvaM2Q8a42Jn6ZTT\n" + 
"5ms6AvNr98sv0StnfmNQ+EYXN0bEk2huSW+w2hN34TYYBTjViQmHbhudwwu8lVjE\n" + 
"ccDmIXsUFbHVK+kTIpWGGchy5cYPs3k9s1nMR2av0Lojtw9WRY76xRXvN8W6R7Eh\n" + 
"wA2ax3+gEEYpGhjM/lO2Lg==\n" + 
"-----END PRIVATE KEY-----\n";

// _test/z4.tsa.cer
var sZ4_CERPEM = 
"-----BEGIN CERTIFICATE-----\n" + 
"MIIDETCCAfmgAwIBAgIBTTANBgkqhkiG9w0BAQUFADAbMQswCQYDVQQGEwJVUzEM\n" + 
"MAoGA1UECgwDQ0ExMB4XDTEzMDUwMTIzNTk1OVoXDTIzMDUwMTIzNTk1OVowHDEL\n" + 
"MAkGA1UEBhMCVVMxDTALBgNVBAMMBFRTQTEwggEiMA0GCSqGSIb3DQEBAQUAA4IB\n" + 
"DwAwggEKAoIBAQDfdOqotHd55SYO0dLz2oXengw/tZ+q3ZmOPeVmMuOMIYO/Cv1w\n" + 
"k2U0OK4pug4OBSJPhl09Zs6IwB8NwPOU7EDTgMOcQUYB/6QNCI1J7Zm2oLtuchzz\n" + 
"4pIb+o4ZAhVprLhRyvqi8OTKQ7kfGfs5Tuwmn1M/0fQkfzMxADpjOKNgf0uy6lN6\n" + 
"utjdTrPKKFUQNdc6/Ty8EeTnQEwUlsT2LAXCfEKxTn5RlRljDztS7Sfgs8VL0FPy\n" + 
"1Qi8B+dFcgRYKFrcpsVaZ1lBmXKsXDRu5QR/Rg3f9DRq4GR1sNH8RLY9uApMl2SN\n" + 
"z+sR4zRPG85R/se5Q06Gu0BUQ3UPm67ETVZLAgMBAAGjXzBdMAwGA1UdEwEB/wQC\n" + 
"MAAwCwYDVR0PBAQDAgbAMBYGA1UdJQEB/wQMMAoGCCsGAQUFBwMIMCgGA1UdHwQh\n" + 
"MB8wHaAboBmGF2h0dHA6Ly90ZXN0LmNvbS9jYTEuY3JsMA0GCSqGSIb3DQEBBQUA\n" + 
"A4IBAQBNkm5GniFi3PKqbafCVN8mpHWJjF2stCRTVxeTCIXUC63YD5XKABGzPH+Y\n" + 
"2R8fCrOa8cGlHmFXOlJye/lnXeZodPyxJUvAKohTp6sG+rJVId8ISI2Io2i5BF8a\n" + 
"CHdm8qd8E0fJvBudqkEc26Ia6tFSA/gEW0ffhsCkN/lXUAjuvDLqtTtU7zBU6dIl\n" + 
"h12Pwyf+x6AsYSciA9zWC6OE590K8Jr2z4u85biM7viWvPeZPNHSNM1fe+8wKbP8\n" + 
"64JtLj/VrglcsXALaUalyh2Hs7gPQzjyus1fyhEWPO3T6KMcBMXjb6anxL5q9YO5\n" + 
"qx1hJTY3L1hahBcMTALQyTEiFv1S\n" + 
"-----END CERTIFICATE-----\n";

// ======= TEST ===============================================================

test("Accuracy", function() {
  expect(2);

  var o = new KJUR.asn1.tsp.Accuracy({seconds: 7, millis: 7, micros: 7});
  equal(o.getEncodedHex(), "3009020107800107810107", "");

  var o2 = new KJUR.asn1.tsp.Accuracy({millis: 500});
  equal(o2.getEncodedHex(), "3004800201f4", "");
});

test("MessageImprint", function() {
  expect(1);
  var o = new KJUR.asn1.tsp.MessageImprint({hashAlg: 'sha256', hashValue: 'a1a2a3a4a5a6a7a8'});
  equal(o.getEncodedHex(), "3019300d060960864801650304020105000408a1a2a3a4a5a6a7a8", "");
});

test("TSTInfo test", function() {
var hExpected = "306202010106042a0304053011300906052b0e03021a05000404a1a2a3a4020103181332303133313233313233353935392e3132335a3004800201f40101ff020103a020a41e301c310b3009060355040613025553310d300b060355040a0c0454535031";
var o = new KJUR.asn1.tsp.TSTInfo({
  policy: '1.2.3.4.5',
  messageImprint: { hashAlg: 'sha1', hashValue: 'a1a2a3a4' },
  serialNumber: {'int': 3},
  genTime: {str: '20131231235959.123Z', millis: true},
  //genTime: {},
  accuracy: { millis: 500 },
  ordering: true,
  nonce: {'int': 3},
  tsa: {'str': '/C=US/O=TSP1'}
});
equal(o.getEncodedHex(), hExpected, "hex");
equal(
ASN1HEX.dump(o.getEncodedHex()), 
ASN1HEX.dump(hExpected),
"dump");
});

test("PKIStatus test", function() {
  var o = new KJUR.asn1.tsp.PKIStatus({int: 0});
  equal(o.getEncodedHex(), "020100", "by int 0");

  var o2 = new KJUR.asn1.tsp.PKIStatus({name: 'granted'});
  equal(o2.getEncodedHex(), "020100", "by name granted");
});

test("PKIFreeText test", function() {
  var o = new KJUR.asn1.tsp.PKIFreeText({array: ['aaa', 'bbb']});
  equal(o.getEncodedHex(), "300a0c036161610c03626262", "by [aaa, bbb]");
});

test("PKIFailureInfo test", function() {
  var o = new KJUR.asn1.tsp.PKIFailureInfo({int: 25});
  equal(o.getEncodedHex(), "030203c8", "by int 25");

  var o2 = new KJUR.asn1.tsp.PKIFailureInfo({name: 'systemFailure'});
  equal(o2.getEncodedHex(), "030203c8", "by name systemFailure");
});

test("PKIStatusInfo test", function() {
  var o = new KJUR.asn1.tsp.PKIStatusInfo({
    status: {name: 'rejection'},
    statstr: ['aaa'],
    failinfo: {name: 'badAlg'}
  });
  equal(o.getEncodedHex(), "300d02010230050c03616161030100", "");
});

test("TSPUtil.newTimeStampToken test", function() {
var hExpected = "308205ad06092a864886f70d010702a082059e3082059a020103310f300d060960864801650304020105003079060b2a864886f70d0109100104a06a0468306602010106042a0304053015300d060960864801650304020105000404a1a2a3a4020103181332303133313233313233353935392e3132335a3004800201f40101ff020103a020a41e301c310b3009060355040613025553310d300b060355040a0c0454535031a082031530820311308201f9a00302010202014d300d06092a864886f70d0101050500301b310b3009060355040613025553310c300a060355040a0c03434131301e170d3133303530313233353935395a170d3233303530313233353935395a301c310b3009060355040613025553310d300b06035504030c045453413130820122300d06092a864886f70d01010105000382010f003082010a0282010100df74eaa8b47779e5260ed1d2f3da85de9e0c3fb59faadd998e3de56632e38c2183bf0afd7093653438ae29ba0e0e05224f865d3d66ce88c01f0dc0f394ec40d380c39c414601ffa40d088d49ed99b6a0bb6e721cf3e2921bfa8e19021569acb851cafaa2f0e4ca43b91f19fb394eec269f533fd1f4247f3331003a6338a3607f4bb2ea537abad8dd4eb3ca28551035d73afd3cbc11e4e7404c1496c4f62c05c27c42b14e7e519519630f3b52ed27e0b3c54bd053f2d508bc07e745720458285adca6c55a6759419972ac5c346ee5047f460ddff4346ae06475b0d1fc44b63db80a4c97648dcfeb11e3344f1bce51fec7b9434e86bb405443750f9baec44d564b0203010001a35f305d300c0603551d130101ff04023000300b0603551d0f0404030206c030160603551d250101ff040c300a06082b0601050507030830280603551d1f0421301f301da01ba0198617687474703a2f2f746573742e636f6d2f6361312e63726c300d06092a864886f70d010105050003820101004d926e469e2162dcf2aa6da7c254df26a475898c5dacb424535717930885d40badd80f95ca0011b33c7f98d91f1f0ab39af1c1a51e61573a52727bf9675de66874fcb1254bc02a8853a7ab06fab25521df08488d88a368b9045f1a087766f2a77c1347c9bc1b9daa411cdba21aead15203f8045b47df86c0a437f9575008eebc32eab53b54ef3054e9d225875d8fc327fec7a02c61272203dcd60ba384e7dd0af09af6cf8bbce5b88ceef896bcf7993cd1d234cd5f7bef3029b3fceb826d2e3fd5ae095cb1700b6946a5ca1d87b3b80f4338f2bacd5fca11163cedd3e8a31c04c5e36fa6a7c4be6af583b9ab1d612536372f585a84170c4c02d0c9312216fd52318201ee308201ea0201013020301b310b3009060355040613025553310c300a060355040a0c0343413102014d300d06096086480165030402010500a081a0301a06092a864886f70d010903310d060b2a864886f70d0109100104302f06092a864886f70d01090431220420d926e24ef0123e83b27a8585e95a0c65b42533d290967e9c833c6b8f5bde66f73051060b2a864886f70d010910020c31423040303e303c041439c9062cec9d6c9f2a54326729032a5843054f9e3024301fa41d301b310b3009060355040613025553310c300a060355040a0c0343413102014d300d06092a864886f70d01010b05000482010045e28eb970c7808b4a9475ef7f3c1c0c9e35d8655ee3d9d6e9efe2b5e2156a8040cf5f93c205569302dca80efe9040817a79af0cc25d726f9544e40894948bceaf67d19f2c182d7451b734264990c76f26cc678ea5df0df4656f5f965e116a77b8401d1b3faa1422f421caffeb6f35805604fa6adef183d873af7515989be17df72998191d3c5ace26f4776ead2244b464361c89cba9cd2981ff4df7ab3e9932f3781b5463eca3b0606661dab28be4902ae8dab996ce63723081e9b43a1d923967d16792ec22c0b987654caa2c264f43b4438a65f7151df8d97d3add5638d725fb75c1ba4514fab4b9ad33c156117001ea9f360dad74b00f3c2b568abb968149";

var o = KJUR.asn1.tsp.TSPUtil.newTimeStampToken({
  tstInfo: {
    policy: '1.2.3.4.5',
    messageImprint: { hashAlg: 'sha256', hashValue: 'a1a2a3a4' },
    serialNumber: {'int': 3},
    //genTime: {millis: true},
    genTime: {str: '20131231235959.123Z', millis: true},
    accuracy: {millis: 500},
    ordering: true,
    nonce: {'int': 3},
    tsa: {'str': '/C=US/O=TSP1'}
  },
  certs: [sZ4_CERPEM],
  signerCert: sZ4_CERPEM,
  hashAlg: 'sha256',
  signerPrvKey: sZ4_PRVP8PPEM,
  sigAlg: 'SHA256withRSA'
});

equal(o.getContentInfoEncodedHex(), hExpected, "hex");

equal(
ASN1HEX.dump(o.getContentInfoEncodedHex()),
ASN1HEX.dump(hExpected),
"dump");
});

test("TimeStampResp class test", function() {
var hExpected = "308205b63003020100308205ad06092a864886f70d010702a082059e3082059a020103310f300d060960864801650304020105003079060b2a864886f70d0109100104a06a0468306602010106042a0304053015300d060960864801650304020105000404a1a2a3a4020103181332303133313233313233353935392e3132335a3004800201f40101ff020103a020a41e301c310b3009060355040613025553310d300b060355040a0c0454535031a082031530820311308201f9a00302010202014d300d06092a864886f70d0101050500301b310b3009060355040613025553310c300a060355040a0c03434131301e170d3133303530313233353935395a170d3233303530313233353935395a301c310b3009060355040613025553310d300b06035504030c045453413130820122300d06092a864886f70d01010105000382010f003082010a0282010100df74eaa8b47779e5260ed1d2f3da85de9e0c3fb59faadd998e3de56632e38c2183bf0afd7093653438ae29ba0e0e05224f865d3d66ce88c01f0dc0f394ec40d380c39c414601ffa40d088d49ed99b6a0bb6e721cf3e2921bfa8e19021569acb851cafaa2f0e4ca43b91f19fb394eec269f533fd1f4247f3331003a6338a3607f4bb2ea537abad8dd4eb3ca28551035d73afd3cbc11e4e7404c1496c4f62c05c27c42b14e7e519519630f3b52ed27e0b3c54bd053f2d508bc07e745720458285adca6c55a6759419972ac5c346ee5047f460ddff4346ae06475b0d1fc44b63db80a4c97648dcfeb11e3344f1bce51fec7b9434e86bb405443750f9baec44d564b0203010001a35f305d300c0603551d130101ff04023000300b0603551d0f0404030206c030160603551d250101ff040c300a06082b0601050507030830280603551d1f0421301f301da01ba0198617687474703a2f2f746573742e636f6d2f6361312e63726c300d06092a864886f70d010105050003820101004d926e469e2162dcf2aa6da7c254df26a475898c5dacb424535717930885d40badd80f95ca0011b33c7f98d91f1f0ab39af1c1a51e61573a52727bf9675de66874fcb1254bc02a8853a7ab06fab25521df08488d88a368b9045f1a087766f2a77c1347c9bc1b9daa411cdba21aead15203f8045b47df86c0a437f9575008eebc32eab53b54ef3054e9d225875d8fc327fec7a02c61272203dcd60ba384e7dd0af09af6cf8bbce5b88ceef896bcf7993cd1d234cd5f7bef3029b3fceb826d2e3fd5ae095cb1700b6946a5ca1d87b3b80f4338f2bacd5fca11163cedd3e8a31c04c5e36fa6a7c4be6af583b9ab1d612536372f585a84170c4c02d0c9312216fd52318201ee308201ea0201013020301b310b3009060355040613025553310c300a060355040a0c0343413102014d300d06096086480165030402010500a081a0301a06092a864886f70d010903310d060b2a864886f70d0109100104302f06092a864886f70d01090431220420d926e24ef0123e83b27a8585e95a0c65b42533d290967e9c833c6b8f5bde66f73051060b2a864886f70d010910020c31423040303e303c041439c9062cec9d6c9f2a54326729032a5843054f9e3024301fa41d301b310b3009060355040613025553310c300a060355040a0c0343413102014d300d06092a864886f70d01010b05000482010045e28eb970c7808b4a9475ef7f3c1c0c9e35d8655ee3d9d6e9efe2b5e2156a8040cf5f93c205569302dca80efe9040817a79af0cc25d726f9544e40894948bceaf67d19f2c182d7451b734264990c76f26cc678ea5df0df4656f5f965e116a77b8401d1b3faa1422f421caffeb6f35805604fa6adef183d873af7515989be17df72998191d3c5ace26f4776ead2244b464361c89cba9cd2981ff4df7ab3e9932f3781b5463eca3b0606661dab28be4902ae8dab996ce63723081e9b43a1d923967d16792ec22c0b987654caa2c264f43b4438a65f7151df8d97d3add5638d725fb75c1ba4514fab4b9ad33c156117001ea9f360dad74b00f3c2b568abb968149";

var dTST = KJUR.asn1.tsp.TSPUtil.newTimeStampToken({
  tstInfo: {
    policy: '1.2.3.4.5',
    messageImprint: { hashAlg: 'sha256', hashValue: 'a1a2a3a4' },
    serialNumber: {'int': 3},
    //genTime: {millis: true},
    genTime: {str: '20131231235959.123Z', millis: true},
    accuracy: {millis: 500},
    ordering: true,
    nonce: {'int': 3},
    tsa: {'str': '/C=US/O=TSP1'}
  },
  certs: [sZ4_CERPEM],
  signerCert: sZ4_CERPEM,
  hashAlg: 'sha256',
  signerPrvKey: sZ4_PRVP8PPEM,
  sigAlg: 'SHA256withRSA'
});
  
var o = new KJUR.asn1.tsp.TimeStampResp({tst: dTST,
                                         status: {status: {name: 'granted'}}});
equal(o.getEncodedHex(), hExpected, "hex");

equal(ASN1HEX.dump(o.getEncodedHex()),ASN1HEX.dump(hExpected), "dump");
});

test("TimeStampReq", function() {
  var nT = KJUR.asn1.tsp;
  expect(2);
  
  var o = new nT.TimeStampReq({
    mi: new nT.MessageImprint({hashAlg: 'sha256', hashValue: 'a1a2a3a4'}),
    policy: {oid: '1.2.3.4.5'},
    nonce: {hex: '9abcf318'},
    certreq: false
  });
  equal(o.getEncodedHex(), "30260201013015300d060960864801650304020105000404a1a2a3a406042a03040502049abcf318", "by mi obj");

  var o2 = new nT.TimeStampReq({
    mi: {hashAlg: 'sha256', hashValue: 'a1a2a3a4'},
    policy: {oid: '0.1.1.2.2'},
    nonce: {hex: '8a8b8c8d8e8f'},
    certreq: true
  });
  equal(o2.getEncodedHex(), "302b0201013015300d060960864801650304020105000404a1a2a3a406040101020202068a8b8c8d8e8f0101ff", "by mi param");
});

test("TSPUtil.parseTimeStampReq", function() {
  expect(18);

  // test TimeStampReq o
  var hex1 = "30260201013015300d060960864801650304020105000404a1a2a3a406042a03040502049abcf318";
  var j1 = KJUR.asn1.tsp.TSPUtil.parseTimeStampReq(hex1);
  equal(typeof j1, "object", "j1");
  equal(j1.mi.hashAlg, "sha256", "mi.hashAlg=sha256");
  equal(j1.mi.hashValue, "a1a2a3a4", "mi.hashValue=a1a2a3a4");
  equal(j1.policy, "1.2.3.4.5", "mi.policy=1.2.3.4.5");
  equal(j1.nonce, "9abcf318", "nonce=9abcf318");
  equal(j1.certreq, false, "certreq=false");

  var hex2 = "302b0201013015300d060960864801650304020105000404a1a2a3a406040101020202068a8b8c8d8e8f0101ff";
  var j2 = KJUR.asn1.tsp.TSPUtil.parseTimeStampReq(hex2);
  equal(typeof j2, "object", "j2");
  equal(j2.mi.hashAlg, "sha256", "mi.hashAlg=sha256");
  equal(j2.mi.hashValue, "a1a2a3a4", "mi.hashValue=a1a2a3a4");
  equal(j2.policy, "0.1.1.2.2", "mi.policy=0.1.1.2.2");
  equal(j2.nonce, "8a8b8c8d8e8f", "nonce=8a8b8c8d8e8f");
  equal(j2.certreq, true, "certreq=true");

  var hex3 = "304c0201013031300d0609608648016503040201050004209834876dcfb05cb167a5c24953eba58c4ac89b1adf57f28f2f9d09af107ee8f006042a030405020b1a1b1c1e1f2a2b2c2d2e2f0101ff";
  var j3 = KJUR.asn1.tsp.TSPUtil.parseTimeStampReq(hex3);
  equal(typeof j3, "object", "j3");
  equal(j3.mi.hashAlg, "sha256", "mi.hashAlg=sha256");
  equal(j3.mi.hashValue, "9834876dcfb05cb167a5c24953eba58c4ac89b1adf57f28f2f9d09af107ee8f0", "mi.hashValue=9834...");
  equal(j3.policy, "1.2.3.4.5", "mi.policy=1.2.3.4.5");
  equal(j3.nonce, "1a1b1c1e1f2a2b2c2d2e2f", "nonce=1a1b...");
  equal(j3.certreq, true, "certreq=true");
});

test("FixedTSAAdapter test", function() {
var tstaaa = "308205cd06092a864886f70d010702a08205be308205ba020103310f300d06096086480165030402010500308198060b2a864886f70d0109100104a0818804818530818202010106042a0304053031300d0609608648016503040201050004209834876dcfb05cb167a5c24953eba58c4ac89b1adf57f28f2f9d09af107ee8f0020103181332303133313233313233353935392e3132335a3004800201f40101ff020103a020a41e301c310b3009060355040613025553310d300b060355040a0c0454535031a082031530820311308201f9a00302010202014d300d06092a864886f70d0101050500301b310b3009060355040613025553310c300a060355040a0c03434131301e170d3133303530313233353935395a170d3233303530313233353935395a301c310b3009060355040613025553310d300b06035504030c045453413130820122300d06092a864886f70d01010105000382010f003082010a0282010100df74eaa8b47779e5260ed1d2f3da85de9e0c3fb59faadd998e3de56632e38c2183bf0afd7093653438ae29ba0e0e05224f865d3d66ce88c01f0dc0f394ec40d380c39c414601ffa40d088d49ed99b6a0bb6e721cf3e2921bfa8e19021569acb851cafaa2f0e4ca43b91f19fb394eec269f533fd1f4247f3331003a6338a3607f4bb2ea537abad8dd4eb3ca28551035d73afd3cbc11e4e7404c1496c4f62c05c27c42b14e7e519519630f3b52ed27e0b3c54bd053f2d508bc07e745720458285adca6c55a6759419972ac5c346ee5047f460ddff4346ae06475b0d1fc44b63db80a4c97648dcfeb11e3344f1bce51fec7b9434e86bb405443750f9baec44d564b0203010001a35f305d300c0603551d130101ff04023000300b0603551d0f0404030206c030160603551d250101ff040c300a06082b0601050507030830280603551d1f0421301f301da01ba0198617687474703a2f2f746573742e636f6d2f6361312e63726c300d06092a864886f70d010105050003820101004d926e469e2162dcf2aa6da7c254df26a475898c5dacb424535717930885d40badd80f95ca0011b33c7f98d91f1f0ab39af1c1a51e61573a52727bf9675de66874fcb1254bc02a8853a7ab06fab25521df08488d88a368b9045f1a087766f2a77c1347c9bc1b9daa411cdba21aead15203f8045b47df86c0a437f9575008eebc32eab53b54ef3054e9d225875d8fc327fec7a02c61272203dcd60ba384e7dd0af09af6cf8bbce5b88ceef896bcf7993cd1d234cd5f7bef3029b3fceb826d2e3fd5ae095cb1700b6946a5ca1d87b3b80f4338f2bacd5fca11163cedd3e8a31c04c5e36fa6a7c4be6af583b9ab1d612536372f585a84170c4c02d0c9312216fd52318201ee308201ea0201013020301b310b3009060355040613025553310c300a060355040a0c0343413102014d300d06096086480165030402010500a081a0301a06092a864886f70d010903310d060b2a864886f70d0109100104302f06092a864886f70d010904312204201d4a377fdf236c74b5b34d90f41e6977c62662984479c9566912f8be8f2b63783051060b2a864886f70d010910020c31423040303e303c041439c9062cec9d6c9f2a54326729032a5843054f9e3024301fa41d301b310b3009060355040613025553310c300a060355040a0c0343413102014d300d06092a864886f70d01010b0500048201006b6e56d24d4773dcec284bdf69fce7d7bc96f649ba0aea53b273faeec3614c2574fdcd4300005775ab3cc19ff501c17a27f95ea8c33528fbd0f93f9f7b2fc77e0c373b9336545084edeeb14a96b0d0c81c3c43a9f8eef36b4283ded61e87aa1b8d4912438e78b2647c38b32f3a1548f0d9bda94c8012ac6248c8b473077d0c9383a50f967f29e412b0c50bc457d5ef2e50f2db9023455ac621bc8f28456d8ef6d190c75be540e82a1a20c8729c828eaf0ac3a3fc85d16532f535d5e88280c20db64b6664b242621429a50cb09bfed094fdcf5df3fc4290fe6c1b25113cb583ace902450e79e51bf6579c7065bc607cb20894aede963788b8f0489c414547e632";

var tstbbb = "308205ed06092a864886f70d010702a08205de308205da020103310f300d060960864801650304020105003081b8060b2a864886f70d0109100104a081a80481a53081a202010106042a0304053051300d0609608648016503040203050004405edc1c6a4390075a3ca27f4d4161c46b374b1c3b2d63f846db6fff0c513203c3ac3b14a24a6f09d8bf21407a4842113b5d9aa359d266299c3d6cf9e92db66dbe020103181332303133313233313233353935392e3132335a3004800201f40101ff020103a020a41e301c310b3009060355040613025553310d300b060355040a0c0454535031a082031530820311308201f9a00302010202014d300d06092a864886f70d0101050500301b310b3009060355040613025553310c300a060355040a0c03434131301e170d3133303530313233353935395a170d3233303530313233353935395a301c310b3009060355040613025553310d300b06035504030c045453413130820122300d06092a864886f70d01010105000382010f003082010a0282010100df74eaa8b47779e5260ed1d2f3da85de9e0c3fb59faadd998e3de56632e38c2183bf0afd7093653438ae29ba0e0e05224f865d3d66ce88c01f0dc0f394ec40d380c39c414601ffa40d088d49ed99b6a0bb6e721cf3e2921bfa8e19021569acb851cafaa2f0e4ca43b91f19fb394eec269f533fd1f4247f3331003a6338a3607f4bb2ea537abad8dd4eb3ca28551035d73afd3cbc11e4e7404c1496c4f62c05c27c42b14e7e519519630f3b52ed27e0b3c54bd053f2d508bc07e745720458285adca6c55a6759419972ac5c346ee5047f460ddff4346ae06475b0d1fc44b63db80a4c97648dcfeb11e3344f1bce51fec7b9434e86bb405443750f9baec44d564b0203010001a35f305d300c0603551d130101ff04023000300b0603551d0f0404030206c030160603551d250101ff040c300a06082b0601050507030830280603551d1f0421301f301da01ba0198617687474703a2f2f746573742e636f6d2f6361312e63726c300d06092a864886f70d010105050003820101004d926e469e2162dcf2aa6da7c254df26a475898c5dacb424535717930885d40badd80f95ca0011b33c7f98d91f1f0ab39af1c1a51e61573a52727bf9675de66874fcb1254bc02a8853a7ab06fab25521df08488d88a368b9045f1a087766f2a77c1347c9bc1b9daa411cdba21aead15203f8045b47df86c0a437f9575008eebc32eab53b54ef3054e9d225875d8fc327fec7a02c61272203dcd60ba384e7dd0af09af6cf8bbce5b88ceef896bcf7993cd1d234cd5f7bef3029b3fceb826d2e3fd5ae095cb1700b6946a5ca1d87b3b80f4338f2bacd5fca11163cedd3e8a31c04c5e36fa6a7c4be6af583b9ab1d612536372f585a84170c4c02d0c9312216fd52318201ee308201ea0201013020301b310b3009060355040613025553310c300a060355040a0c0343413102014d300d06096086480165030402010500a081a0301a06092a864886f70d010903310d060b2a864886f70d0109100104302f06092a864886f70d0109043122042087a975b53146faf75e52d933343b1ba4b59749d14d209dd9618aa2d30aada9493051060b2a864886f70d010910020c31423040303e303c041439c9062cec9d6c9f2a54326729032a5843054f9e3024301fa41d301b310b3009060355040613025553310c300a060355040a0c0343413102014d300d06092a864886f70d01010b0500048201004de90596bc21ef083dad98334077885146b30723265a0f32f1804264be62160709aebf1de545640daf840a7630159ced55855d99acdaef4637a48bbe22e0552c722282cc85bc5ce736cc847748d9ddc1b992a613ae3026c4f1a7e9aa67ed1a8c656a5e27fb23f3804c2baa20b057661fc2fbd29f07aa2b493637a912a1555aa4976ec22564d1507061cd8cab72c4344fb0f495ceae0563d9d5a010ffebc29776d17a89df83adfb7440ce54a6de33aed365517f09a4a17f66a5a0b01d45d73d258c46eeff3dfe8dd51443471be21301ad5f8e4b6bbba8a83a97f8896357b50ad43d92063030ac0263948b42eb8293a498de2f930238ef9239905fea95c8af6fba";

var tsa = new KJUR.asn1.tsp.FixedTSAAdapter({
  tstInfo: {
    policy: '1.2.3.4.5',
    messageImprint: {},
    serialNumber: {'int': 3},
    genTime: {str: '20131231235959.123Z', millis: true},
    accuracy: {millis: 500},
    ordering: true,
    nonce: {'int': 3},
    tsa: {'str': '/C=US/O=TSP1'}
  },
  certs: [sZ4_CERPEM],
  signerCert: sZ4_CERPEM,
  hashAlg: 'sha256',
  signerPrvKey: sZ4_PRVP8PPEM,
  sigAlg: 'SHA256withRSA'
});

equal(
ASN1HEX.dump(tsa.getTSTHex('616161', 'sha256')),
ASN1HEX.dump(tstaaa),
"aaa 1 dump");

equal(
ASN1HEX.dump(tsa.getTSTHex('626262', 'sha512')),
ASN1HEX.dump(tstbbb),
"bbb 1 sha512 dump");

equal(tsa.getTSTHex('616161', 'sha256'), tstaaa, 'aaa 1');
equal(tsa.getTSTHex('616161', 'sha256'), tstaaa, 'aaa 2');
equal(tsa.getTSTHex('626262', 'sha512'), tstbbb, 'bbb 1');
equal(tsa.getTSTHex('626262', 'sha512'), tstbbb, 'bbb 2');
});

test("SimpleTSAAdapter", function() {
var tsa = new KJUR.asn1.tsp.SimpleTSAAdapter({
  tstInfo: {
    policy: '1.2.3.4.5',
    messageImprint: {},
    serialNumber: {'int': 3},
    genTime: {millis: true},
    accuracy: {millis: 500},
    ordering: true,
    nonce: {'int': 3},
    tsa: {'str': '/C=US/O=TSP1'}
  },
  certs: [sZ4_CERPEM],
  signerCert: sZ4_CERPEM,
  hashAlg: 'sha256',
  signerPrvKey: sZ4_PRVP8PPEM,
  sigAlg: 'SHA256withRSA'
});

equal(tsa.getTSTHex('616161', 'sha256').substr(0, 2), '30', 'aaa 1');
equal(tsa.getTSTHex('616161', 'sha256').substr(0, 2), '30', 'aaa 2');
equal(tsa.getTSTHex('626262', 'sha256').substr(0, 2), '30', 'bbb 1');
equal(tsa.getTSTHex('626262', 'sha256').substr(0, 2), '30', 'bbb 2');
});


});
-->
</script>
  
</head>
<body>
<div id="qunit"></div>
<div id="qunit-fixture">test markup</div>

<p>
<a href="../">TOP</a> | 
<a href="index.html">TEST INDEX</a> | 
<a href="qunit-do-asn1.html">asn1</a> | 
<a href="qunit-do-asn1x509.html">asn1x509</a> | 
<a href="qunit-do-asn1cms.html">asn1cms</a> | 
<a href="qunit-do-asn1tsp.html">asn1tsp</a> | 
<a href="../api/index.html">APIDOCS</a> | 
</p>

</body>
</html>
